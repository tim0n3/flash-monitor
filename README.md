# Storage Monitoring Script

This Bash script is part of a two-script system designed to monitor storage usage on your system and take actions based on changes in available disk space. This script specifically performs the monitoring and logging aspect of the functionality stack.

**Please Note:** To achieve the full functionality, you'll need to run another complementary script alongside this one.

## Table of Contents

- [Features](#features)
- [Prerequisites](#prerequisites)
- [Usage](#usage)
- [How It Works](#how-it-works)
- [License](#license)

## Features

- Monitors available disk space on specified storage devices.
- Logs storage information to a CSV file.
- Periodically checks for changes in available disk space and writes a lock file accordingly.
- Option to truncate log files in `/var/log/`.

## Prerequisites

Before using this script, ensure you have the following prerequisites:

- A Linux system with `bash` installed.
- Access to write log files to `/var/log/`.
- Proper permissions to execute the script (use `chmod +x script.sh` if needed).

## Usage

1. Download the script and make it executable:

   ```bash
   chmod +x storage_monitor.sh
   ```

2. Execute the script:

   ```bash
   ./storage_monitor.sh
   ```

3. Keep the script running in the background.

4. Run the complementary script to take actions based on the lock file generated by this script.

## How It Works

This script continuously monitors the available disk space on specified physical storage devices and logs this information to a CSV file located at `/var/log/free-space-<timestamp>.csv`. The script also calculates the percentage change in available space between consecutive checks.

- The script begins by listing physical storage devices (e.g., `/dev/sda`, `/dev/sdb`) and retrieving their available disk space using the `df` command.

- It logs this information in the CSV file, including the drive name and available space.

- The script then starts a background process to continuously monitor storage usage.

- In the background, it checks for changes in available disk space every 30 seconds. If the change is greater than 5%, it writes '1' to a lock file (`/root/free.lock`), indicating a significant change. Otherwise, it writes '0' to the lock file.

- The main script also runs in the background, continuously checking the lock file every 60 seconds. Based on the value in the lock file, it either truncates log files in `/var/log/` or does nothing.

This script can be used in conjunction with another script that performs actions (e.g., alerting or cleaning up) based on the value in the lock file.

## Donations

If you want to show your appreciation, you can donate via [PayPal](https://www.paypal.com/donate?hosted_button_id=ULMMXE4DLQVZS) . Thanks!

## License

This script is released under the [MIT License](LICENSE).

---

*Disclaimer: Use this script at your own risk. Make sure to test it in a controlled environment before deploying it to production systems.*
